# 🚀 سیستم CRM جامع (RABIN-tejarat)

سیستم جامع مدیریت ارتباط با مشتری (CRM) همراه با قابلیت‌های مدیریت تجربه مشتری (CEM)، ساخته شده با Next.js، MySQL و Docker.

## ✨ ویژگی‌ها

- **مدیریت مشتریان**: مدیریت کامل چرخه حیات مشتری
- **پایپ‌لاین فروش**: مسیر فروش با مراحل قابل تنظیم
- **ردیابی فعالیت‌ها**: پیگیری تمام تعاملات مشتری
- **مدیریت وظایف**: سازماندهی و اولویت‌بندی وظایف
- **تقویم یکپارچه**: برنامه‌ریزی و مدیریت قرارها
- **گزارش‌گیری و تحلیل**: بینش‌های جامع کسب‌وکار
- **مدیریت کاربران**: کنترل دسترسی مبتنی بر نقش
- **سیستم اطلاع‌رسانی**: اطلاع‌رسانی ایمیل و پیامک
- **سیستم پشتیبان‌گیری**: پشتیبان‌گیری خودکار دیتابیس
- **پشتیبانی چندزبانه**: فارسی و انگلیسی

## 🛠️ تکنولوژی‌های استفاده شده

- **Frontend**: Next.js 14, React 18, TypeScript
- **Backend**: Next.js API Routes, Node.js
- **Database**: MySQL 8.0
- **Styling**: Tailwind CSS, Radix UI
- **Authentication**: NextAuth.js
- **Containerization**: Docker, Docker Compose
- **Web Server**: Nginx (Reverse Proxy)

## 🚀 شروع سریع

### پیش‌نیازها

- Docker و Docker Compose
- Node.js 18+ (برای توسعه محلی)
- Git

### نصب

1. کلون کردن مخزن:
```bash
git clone https://github.com/Ahmadreza-Avandi/RABIN-tejarat.git
cd RABIN-tejarat
```

2. کپی متغیرهای محیطی:
```bash
cp .env.example .env
```

3. راه‌اندازی اپلیکیشن:
```bash
docker-compose up -d
```

4. دسترسی به اپلیکیشن:
- اپلیکیشن اصلی: http://localhost:3000
- phpMyAdmin: http://localhost:8080

## 🔧 توسعه

### راه‌اندازی محیط توسعه

```bash
# شروع محیط توسعه
./dev.sh start

# توقف محیط توسعه
./dev.sh stop

# مشاهده لاگ‌ها
./dev.sh logs

# ری‌ست دیتابیس
./dev.sh db-reset

# باز کردن shell
./dev.sh shell
```

### دسترسی به سرویس‌های توسعه:
- Next.js: http://localhost:3000
- phpMyAdmin: http://localhost:8080
- MySQL: localhost:3307

## 🌐 دیپلوی Production

### نیازمندی‌های سرور

- Ubuntu 20.04+ یا CentOS 8+
- حداقل 2GB RAM
- حداقل 20GB فضای دیسک
- Docker و Docker Compose

### مراحل دیپلوی

1. کلون و تنظیم:
```bash
git clone https://github.com/Ahmadreza-Avandi/RABIN-tejarat.git
cd RABIN-tejarat
cp .env.production .env
# ویرایش .env با مقادیر production
```

2. دیپلوی:
```bash
./deploy.sh
```

3. دسترسی به اپلیکیشن:
- اپلیکیشن اصلی: https://ahmadreza-avandi.ir
- phpMyAdmin: https://ahmadreza-avandi.ir/phpmyadmin

### مدیریت Production

```bash
# شروع سرویس‌ها
./manage.sh start

# توقف سرویس‌ها
./manage.sh stop

# مشاهده وضعیت
./manage.sh status

# مشاهده لاگ‌ها
./manage.sh logs

# پشتیبان‌گیری دیتابیس
./manage.sh backup

# بروزرسانی سیستم
./manage.sh update

# مانیتورینگ سیستم
./manage.sh monitor
```

## 📊 ساختار دیتابیس

سیستم شامل ساختار جامع دیتابیس با:

- **کاربران و احراز هویت**: مدیریت کاربران و نقش‌ها
- **مشتریان و شرکت‌ها**: اطلاعات مشتری و شرکت
- **معاملات و پایپ‌لاین**: مدیریت مسیر فروش
- **فعالیت‌ها و وظایف**: ردیابی فعالیت و مدیریت وظایف
- **تقویم و رویدادها**: مدیریت تقویم و رویداد
- **اطلاع‌رسانی**: اطلاع‌رسانی ایمیل و پیامک
- **بازخورد و پشتیبانی**: بازخورد مشتری و تیکت‌های پشتیبانی
- **گزارش‌ها و تحلیل**: هوش تجاری و گزارش‌گیری

## 🔒 ویژگی‌های امنیتی

- **احراز هویت**: احراز هویت امن کاربر با NextAuth.js
- **مجوزدهی**: کنترل دسترسی مبتنی بر نقش
- **اعتبارسنجی داده**: اعتبارسنجی و پاکسازی ورودی
- **محافظت از SQL Injection**: کوئری‌های پارامتری
- **محافظت XSS**: هدرهای Content Security Policy
- **HTTPS**: رمزگذاری SSL/TLS
- **محدودیت نرخ**: محدودیت نرخ API
- **مدیریت جلسه**: مدیریت امن جلسه

## 💾 پشتیبان‌گیری و بازیابی

### پشتیبان‌گیری خودکار

سیستم شامل قابلیت پشتیبان‌گیری خودکار:

- پشتیبان‌گیری روزانه دیتابیس
- دوره نگهداری قابل تنظیم
- اطلاع‌رسانی ایمیل برای وضعیت پشتیبان
- گزینه‌های فشرده‌سازی و رمزگذاری

### پشتیبان‌گیری دستی

```bash
# ایجاد پشتیبان
./manage.sh backup

# بازیابی از پشتیبان
./manage.sh restore
```

## 📈 مانیتورینگ و لاگ‌گیری

### بررسی سلامت

- نقطه پایانی سلامت اپلیکیشن: `/api/health`
- مانیتورینگ اتصال دیتابیس
- مانیتورینگ وضعیت سرویس

### لاگ‌گیری

- لاگ‌های اپلیکیشن: لاگ‌های کانتینر Docker
- لاگ‌های دسترسی: لاگ‌های دسترسی Nginx
- لاگ‌های خطا: لاگ‌های خطای اپلیکیشن
- لاگ‌های حسابرسی: لاگ‌های فعالیت کاربر

## 🔧 عیب‌یابی

### مشکلات رایج

1. **مشکلات اتصال دیتابیس**:
   - بررسی وضعیت کانتینر MySQL
   - تأیید اعتبارنامه‌های دیتابیس
   - بررسی اتصال شبکه

2. **مشکلات حافظه**:
   - مانیتورینگ استفاده از حافظه کانتینر
   - تنظیم محدودیت‌های حافظه در docker-compose.yml
   - پاکسازی منابع Docker استفاده نشده

3. **مشکلات گواهی SSL**:
   - تأیید تنظیمات DNS دامنه
   - بررسی وضعیت گواهی Let's Encrypt
   - تمدید گواهی‌ها در صورت انقضا

### دستورات عیب‌یابی

```bash
# بررسی وضعیت کانتینر
docker-compose ps

# مشاهده لاگ‌های کانتینر
docker-compose logs [service-name]

# بررسی استفاده از منابع
docker stats

# تست اتصال دیتابیس
docker-compose exec mysql mysqladmin ping -h localhost -u root -p
```

## 📚 مستندات

- [راهنمای دیپلوی](DEPLOYMENT_GUIDE.md)
- [راهنمای تنظیم ایمیل](EMAIL_TEMPLATE_GUIDE.md)
- [راهنمای تنظیم پیامک](SMS_SETUP_GUIDE.md)
- [راهنمای سیستم پشتیبان‌گیری](BACKUP_SYSTEM_GUIDE.md)

## 🤝 مشارکت

1. Fork کردن مخزن
2. ایجاد شاخه ویژگی
3. اعمال تغییرات
4. اضافه کردن تست‌ها در صورت لزوم
5. ارسال pull request

## 📄 مجوز

این پروژه تحت مجوز ISC منتشر شده است.

## 🆘 پشتیبانی

برای پشتیبانی و سوالات:

- ایجاد issue در مخزن
- بررسی بخش عیب‌یابی
- مطالعه راهنمای دیپلوی

## 📝 تغییرات

### نسخه 1.0.0
- انتشار اولیه
- قابلیت کامل CRM
- کانتینری‌سازی Docker
- اسکریپت‌های دیپلوی production
- مستندات جامع

---

## 🚀 نحوه اجرا

### برای Development:
```bash
./dev.sh start
```

### برای Production:
```bash
./deploy.sh
```

### مدیریت Production:
```bash
./manage.sh [command]
```

**🎉 سیستم شما آماده است!**